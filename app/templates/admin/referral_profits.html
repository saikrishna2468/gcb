<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<style>
    /* Navbar Styles */
    .nav-buttons {
       display: flex;
       justify-content: center;
       flex-wrap: wrap;
       gap: 15px;
       margin: 20px 0;
   }

   .nav-buttons a {
       padding: 12px 25px;
       border-radius: 25px;
       font-size: 16px;
       color: #fff;
       text-decoration: none;
       transition: all 0.3s ease;
       box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
   }

   .nav-buttons a.btn-success {
       background-color: #28a745;
       border: 2px solid #28a745;
   }

   .nav-buttons a.btn-info {
       background-color: #17a2b8;
       border: 2px solid #17a2b8;
   }

   .nav-buttons a.btn-danger {
       background-color: #dc3545;
       border: 2px solid #dc3545;
   }

   /* Button Hover Effects */
   .nav-buttons a:hover {
       transform: scale(1.05);
       box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
   }

   /* Animation Effects */
   @keyframes fadeInUp {
       0% {
           opacity: 0;
           transform: translateY(20px);
       }

       100% {
           opacity: 1;
           transform: translateY(0);
       }
   }

   .nav-buttons a {
       animation: fadeInUp 1s ease both;
   }

   .nav-buttons a:nth-child(1) {
       animation-delay: 0.1s;
   }

   .nav-buttons a:nth-child(2) {
       animation-delay: 0.2s;
   }

   .nav-buttons a:nth-child(3) {
       animation-delay: 0.3s;
   }

   .nav-buttons a:nth-child(4) {
       animation-delay: 0.4s;
   }

   .nav-buttons a:nth-child(5) {
       animation-delay: 0.5s;
   }

   .nav-buttons a:nth-child(6) {
       animation-delay: 0.6s;
   }
</style>
  <!-- Navigation Buttons -->
  <div class="nav-buttons text-center">
    <a href="{% url 'admin_dashboard' %}" class="btn btn-success">admin_dashboard</a>
    <a href="{% url 'add_product' %}" class="btn btn-success">Add New Product</a>
    <a href="{% url 'admin_product_list' %}" class="btn btn-success">Product List</a>
    <a href="{% url 'admin_view_referrals' %}" class="btn btn-info">View Referral History</a>
    <a href="{% url 'admin_payment_history' %}" class="btn btn-info">Payment History</a>
    <a href="{% url 'referral_profits' %}" class="btn btn-info">Referral Profits</a>
    <a href="{% url 'admin_user_list' %}" class="btn btn-info">User list</a>
    <a class="btn btn-info" href="{% url 'admin_feedback_list' %}">Admin Feedback List</a> <!-- Only for admin users -->
    <a href="{% url 'logout_admin' %}" class="btn btn-danger">Logout</a>
</div>
<h2 class="heading text-center" >Referral Profits</h2>
<div class="row p-5">
    <div class="col-sm-6">
        <canvas id="profitChart" width="200" height="200"></canvas>
    </div>
    <div class="col-sm-6 p-5">
        <h3>Overview of Referral Profits</h3>
        <p>
            This chart displays the profits earned from referrals. Each bar represents the profit 
            generated by a user for referring another user to our platform. The amounts are 
            shown in Indian Rupees (Rs.) for easy reference. Analyze your referral performance 
            and see how your efforts contribute to overall profits.
        </p>
        <p>
            Referral programs are an effective way to grow our community. Encourage more users 
            to join, and maximize your profits by sharing your unique referral link.
        </p>
    </div>
</div>

<div class="card-container">
    {% for profit in profits %}
    <div class="card profit-card">
        <div class="card-body">
            <small class="card-title">{{ profit.user.username }} referred {{ profit.referred_user.username }}</small>
            <p class="card-text">Profit Amount: <strong>Rs. {{ profit.amount }}</strong></p>
            <p class="card-text"><small class="text-muted">Date: {{ profit.created_at }}</small></p>
        </div>
    </div>
    {% empty %}
    <div class="card profit-card">
        <div class="card-body">
            <p class="card-text">No referral profits found.</p>
        </div>
    </div>
    {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const profits = [
        {% for profit in profits %}
            {
                username: "{{ profit.user.username }}",
                referredUser: "{{ profit.referred_user.username }}",
                amount: {{ profit.amount }},
                date: "{{ profit.created_at }}"
            },
        {% endfor %}
    ];

    const labels = profits.map(profit => `${profit.username} ➜ ${profit.referredUser}`);
    const data = profits.map(profit => profit.amount);

    // Function to generate a random color in hex format
    function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    // Create an array of random colors for each dataset entry
    const backgroundColors = data.map(() => getRandomColor());
    const borderColors = data.map(() => getRandomColor());

    const ctx = document.getElementById('profitChart').getContext('2d');
    const profitChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Profit Amount (Rs.)',
                data: data,
                backgroundColor: backgroundColors,
                borderColor: borderColors,
                borderWidth: 1,
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Profit Amount (Rs.)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Referrer ➜ Referred User'
                    }
                }
            },
            animation: {
                duration: 500,
                easing: 'easeInOutBounce'
            }
        }
    });
</script>

<style>
    .card-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin: 20px 0;
    }

    .profit-card {
        background: #ffffff; /* White background for contrast */
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin: 10px;
        padding: 20px;
        width: 300px;
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative; /* Needed for animation effect */
        overflow: hidden; /* Hide overflowing elements */
    }

    .profit-card:hover {
        transform: translateY(-5px); /* Lift effect on hover */
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.15);
    }

    .profit-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom right, rgba(106, 27, 154, 0.1), rgba(106, 27, 154, 0.05));
        z-index: 0;
        transition: opacity 0.3s ease;
        opacity: 0;
    }

    .profit-card:hover::before {
        opacity: 1; /* Show gradient background on hover */
    }

    .card-title {
        font-weight: bold;
        color: #6a1b9a; /* Stylish purple */
    }

    .card-text {
        color: #333;
    }
</style>
